<html>
<head>
  <title>Campaign Order Page</title>
</head>
<body>

<!-- Page View Tracking -->
<script async src="https://campaigns.anuwatwork.com/js/v1/campaign/"></script>
<script>
  window.addEventListener('load', function () {
    nextCampaign.config({
      apiKey: "g8ep0a5wYUIqOkaYDJcHOWyqk1et813Pj5OxV48X",
    });
    nextCampaign.event('page_view', {
      title: document.title,
      url: window.location.href
    });
  });
</script>

<h2>Create Cart</h2>
<form id="cartForm">
  <fieldset>
    <legend>User Info</legend>
    <label>Email: <input type="email" name="email" required></label><br>
    <label>First Name: <input type="text" name="first_name" required></label><br>
    <label>Last Name: <input type="text" name="last_name" required></label><br>
    <label>Phone Number: <input type="text" name="phone_number" required></label><br>
    <label>Language: <input type="text" name="language"></label><br>
    <label>Accepts Marketing: <input type="checkbox" name="accepts_marketing" checked></label>
  </fieldset>

  <fieldset>
    <legend>Address</legend>
    <label>Country: <input type="text" name="country" required></label><br>
    <label>First Name: <input type="text" name="addr_first_name" required></label><br>
    <label>Last Name: <input type="text" name="addr_last_name" required></label><br>
    <label>Line1: <input type="text" name="line1"></label><br>
    <label>Line2: <input type="text" name="line2"></label><br>
    <label>Line3: <input type="text" name="line3"></label><br>
    <label>Line4: <input type="text" name="line4"></label><br>
    <label>State: <input type="text" name="state"></label><br>
    <label>Postcode: <input type="text" name="postcode"></label><br>
    <label>Phone Number: <input type="text" name="addr_phone_number"></label><br>
    <label>Notes: <input type="text" name="notes"></label>
  </fieldset>

  <fieldset>
    <legend>Package Line</legend>
    <label>Package ID: <input type="number" name="package_id" required></label><br>
    <label>Quantity: <input type="number" name="quantity" value="1"></label><br>
    <label>Is Upsell: <input type="checkbox" name="is_upsell"></label>
  </fieldset>

  <fieldset>
    <legend>Attribution</legend>
    <label>Funnel: <input type="text" name="funnel"></label><br>
    <label>UTM Source: <input type="text" name="utm_source"></label><br>
    <label>UTM Medium: <input type="text" name="utm_medium"></label><br>
    <label>UTM Campaign: <input type="text" name="utm_campaign"></label><br>
    <label>UTM Term: <input type="text" name="utm_term"></label><br>
    <label>UTM Content: <input type="text" name="utm_content"></label><br>
    <label>GCLID: <input type="text" name="gclid"></label><br>
    <label>Affiliate: <input type="text" name="affiliate"></label><br>
    <label>Subaffiliate 1-5:<br>
      <input type="text" name="subaffiliate1"><br>
      <input type="text" name="subaffiliate2"><br>
      <input type="text" name="subaffiliate3"><br>
      <input type="text" name="subaffiliate4"><br>
      <input type="text" name="subaffiliate5">
    </label><br>
    <label>Metadata Property 1: <input type="text" name="property1"></label><br>
    <label>Metadata Property 2: <input type="text" name="property2"></label>
  </fieldset>

  <fieldset>
    <legend>Vouchers</legend>
    <label>Vouchers (comma separated): <input type="text" name="vouchers"></label>
  </fieldset>

  <button type="submit">Create Cart</button>
</form>

<hr>

<h2>Submit Order</h2>
<form id="orderForm">
  <!-- User Info -->
  <label>Email: <input type="email" name="email" required></label><br>
  <label>First Name: <input type="text" name="first_name" required></label><br>
  <label>Last Name: <input type="text" name="last_name" required></label><br>
  <label>Phone: <input type="text" name="phone_number" required></label><br>

  <!-- Package Info -->
  <label>Package ID: <input type="number" name="package_id" required></label><br>
  <label>Quantity: <input type="number" name="quantity" value="1" required></label><br>

  <!-- Payment -->
  <label>Card Token: <input type="text" name="card_token" required></label><br>

  <!-- Address -->
  <label>Shipping Method ID: <input type="number" name="shipping_method" value="1" required></label><br>
  <label>Country: <input type="text" name="country" value="US"></label><br>
  <label>Line1: <input type="text" name="line1" required></label><br>
  <label>State: <input type="text" name="state" required></label><br>
  <label>Postcode: <input type="text" name="postcode" required></label><br>
  <label>City (Line4): <input type="text" name="line4" required></label><br>
  <label>Phone: <input type="text" name="address_phone" required></label><br>

  <button type="submit">Submit Order</button>
</form>

<hr>

<h2>Submit Upsell</h2>
<label>Order Ref ID: <input type="text" id="orderRefId" required></label><br>
<label>Package ID: <input type="number" id="upsellPackageId" value="1" required></label><br>
<button id="submitUpsellBtn">Submit Upsell</button>

<script>
  const API_KEY = 'g8ep0a5wYUIqOkaYDJcHOWyqk1et813Pj5OxV48X';

  document.getElementById('cartForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const form = e.target;

    const payload = {
      user: {
        email: form.email.value,
        first_name: form.first_name.value,
        last_name: form.last_name.value,
        phone_number: form.phone_number.value,
        language: form.language.value,
        accepts_marketing: form.accepts_marketing.checked
      },
      address: {
        country: form.country.value,
        first_name: form.addr_first_name.value,
        last_name: form.addr_last_name.value,
        line1: form.line1.value,
        line2: form.line2.value,
        line3: form.line3.value,
        line4: form.line4.value,
        state: form.state.value,
        postcode: form.postcode.value,
        phone_number: form.addr_phone_number.value,
        notes: form.notes.value
      },
      lines: [
        {
          package_id: parseInt(form.package_id.value),
          quantity: parseInt(form.quantity.value),
          is_upsell: form.is_upsell.checked
        }
      ],
      attribution: {
        funnel: form.funnel.value,
        utm_source: form.utm_source.value,
        utm_medium: form.utm_medium.value,
        utm_campaign: form.utm_campaign.value,
        utm_term: form.utm_term.value,
        utm_content: form.utm_content.value,
        gclid: form.gclid.value,
        affiliate: form.affiliate.value,
        subaffiliate1: form.subaffiliate1.value,
        subaffiliate2: form.subaffiliate2.value,
        subaffiliate3: form.subaffiliate3.value,
        subaffiliate4: form.subaffiliate4.value,
        subaffiliate5: form.subaffiliate5.value,
        metadata: {
          property1: form.property1.value || null,
          property2: form.property2.value || null
        }
      },
      vouchers: form.vouchers.value
        .split(',')
        .map(v => v.trim())
        .filter(v => v !== "")
    };

    fetch('https://campaigns.anuwatwork.com/api/v1/carts/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': API_KEY
      },
      body: JSON.stringify(payload)
    })
    .then(res => {
      if (!res.ok) throw new Error("Error: " + res.status);
      return res.json();
    })
    .then(data => {
      console.log("Cart created:", data);
      alert("Cart created successfully!");
    })
    .catch(err => {
      console.error(err);
      alert("Failed to create cart.");
    });
  });

  document.getElementById('orderForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const form = e.target;
    const address = {
      first_name: form.first_name.value,
      last_name: form.last_name.value,
      country: form.country.value,
      line1: form.line1.value,
      state: form.state.value,
      postcode: form.postcode.value,
      line4: form.line4.value,
      phone_number: form.address_phone.value
    };

    const payload = {
      lines: [
        {
          package_id: parseInt(form.package_id.value),
          quantity: parseInt(form.quantity.value)
        }
      ],
      user: {
        email: form.email.value,
        first_name: form.first_name.value,
        last_name: form.last_name.value,
        phone_number: form.phone_number.value,
        ip: "0.0.0.0"
      },
      attribution: {
        funnel: "M funnel",
        utm_source: "PA utm_source",
        utm_medium: "PA utm_medium",
        utm_campaign: "PA utm_campaign",
        utm_term: "PA utm_term",
        utm_content: "PA utm_content",
        gclid: "PA gclid",
        metadata: {
          attribution_meta_decimal: "0.01",
          attribution_meta_integer: "1000",
          attribution_meta_text: "Han"
        },
        affiliate: "PA affiliate",
        subaffiliate1: "PA subaffiliate1",
        subaffiliate2: "PA subaffiliate2",
        subaffiliate3: "PA subaffiliate3",
        subaffiliate4: "PA subaffiliate4",
        subaffiliate5: "PA subaffiliate5",
        agent: 1
      },
      payment_detail: {
        payment_method: "card_token",
        card_token: form.card_token.value
      },
      shipping_address: address,
      billing_address: address,
      shipping_method: parseInt(form.shipping_method.value),
      success_url: "http://sandbox.localhost:3333/"
    };

    fetch('https://campaigns.anuwatwork.com/api/v1/orders/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': API_KEY
      },
      body: JSON.stringify(payload)
    })
    .then(res => res.json())
    .then(data => {
      console.log('Order Success:', data);
      alert('Order submitted!');
    })
    .catch(err => {
      console.error(err);
      alert('Failed to submit order.');
    });
  });

  document.getElementById('submitUpsellBtn').addEventListener('click', function () {
    const orderRefId = document.getElementById('orderRefId').value.trim();
    const packageId = parseInt(document.getElementById('upsellPackageId').value);

    if (!orderRefId || !packageId) {
      alert("Please provide valid Order Ref ID and Package ID.");
      return;
    }

    const payload = {
      lines: [{ package_id: packageId }]
    };

    fetch(`https://campaigns.anuwatwork.com/api/v1/orders/${encodeURIComponent(orderRefId)}/upsells/`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': API_KEY
      },
      body: JSON.stringify(payload)
    })
    .then(res => res.json())
    .then(data => {
      console.log('Upsell Success:', data);
      alert('Upsell submitted!');
    })
    .catch(err => {
      console.error(err);
      alert('Failed to submit upsell.');
    });
  });
</script>
</body>
</html>
